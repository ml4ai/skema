<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="University of Arizona &amp; Lum AI">
  <link rel="canonical" href="https://ml4ai.github.io/skema/dev/adding_new_tree_sitter_frontend/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Adding a new tree-sitter frontend - skema</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Adding a new tree-sitter frontend";
    var mkdocs_page_input_path = "dev/adding_new_tree_sitter_frontend.md";
    var mkdocs_page_url = "/skema/dev/adding_new_tree_sitter_frontend/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> skema</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../software/">Software</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../changes/">Releases</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../team/">Team</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../license/">License</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../examples/">Examples</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developing</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../env/">Configuring your development environment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../eqn2mml/">Configuring <code>img2mml</code></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../docs/">Building documentation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../coverage/">Test coverage reports</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../coverage/code2fn_coverage/report.html">Code2fn coverage reports</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../docker/">Building docker images</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../creating-an-incremental-release/">Publishing an incremental release</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../adding_new_model/">Adding a new model</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Adding a new tree-sitter frontend</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../generating_code2fn_model_coverage/">Generating code2fn model coverage reports</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../using_code_ingestion_frontends/">Using code ingestion frontends</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../using_tree_sitter_preprocessor/">Using tree-sitter preprocessor</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API (Python)</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/python/skema/gromet/"><code>skema.gromet</code></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/python/skema/img2mml/"><code>skema.img2mml</code></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/python/skema/isa/"><code>skema.isa</code></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/python/skema/skema_py/"><code>skema.skema_py</code></a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API (Rust)</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/rust/help.html"><code>skema.rust</code></a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API (Scala)</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../api/scala/index.html"><code>skema.scala</code></a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">skema</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developing &raquo;</li>
        
      
    
    <li>Adding a new tree-sitter frontend</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ml4ai/skema/blob/main/docs/dev/adding_new_tree_sitter_frontend.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h2 id="language-support">Language support<a class="headerlink" href="#language-support" title="Permanent link"></a></h2>
<p>If the language you wish to use does not already have a <a href="https://tree-sitter.github.io/tree-sitter/#parsers">Tree-sitter parser</a>, you can create it with a grammar for that language.</p>
<h2 id="building-the-tree-sitter-parser">Building the Tree-sitter parser<a class="headerlink" href="#building-the-tree-sitter-parser" title="Permanent link"></a></h2>
<p><strong>Requirements</strong>:
* A GitHub repository with a grammar file named <code>grammar.js</code> for the language you wish to support. 
* Tree-sitter also support writing your own grammar file from scratch with the steps <a href="https://tree-sitter.github.io/tree-sitter/creating-parsers">shown here.</a></p>
<p><strong>Steps</strong>:
1. In directory <code>skema/program_analysis/tree_sitter_parsers/</code> do the following:
2. Add new entry to <code>languages.yaml</code></p>
<pre><code class="language-yaml">matlab:
  tree_sitter_name: tree-sitter-matlab
  clone_url: https://github.com/acristoffers/tree-sitter-matlab.git
  supports_comment_extraction: True
  supports_fn_extraction: True
  extensions:
    - .m
</code></pre>
<ol>
<li>Run  <code>build_parsers.py</code>. Adding an entry to <code>languages.yaml</code> will automatically create a new command line argument for <code>build_parsers.py</code>.</li>
</ol>
<pre><code class="language-bash">python  build_languages.py --matlab
</code></pre>
<p>If successful, a build directory will have been created with a language object file <code>installed_languages.so</code> </p>
<h2 id="using-the-tree-sitter-parser">Using the tree-sitter parser<a class="headerlink" href="#using-the-tree-sitter-parser" title="Permanent link"></a></h2>
<p><strong>Requirements:</strong>
* Tree-sitter language object file built using above steps</p>
<p><strong>Steps:</strong>
1. Import the path to the tree-sitter library. </p>
<pre><code class="language-python">from skema.program_analysis.CAST.tree_sitter_parsers.build_parsers import INSTALLED_LANGUAGES_FILEPATH
</code></pre>
<ol>
<li>Create the Language object. This is used for parsing or running queries.</li>
</ol>
<pre><code class="language-python">language_object = Language(INSTALLED_LANGUAGES_FILEPATH, &quot;matlab&quot;)
</code></pre>
<ol>
<li>Parse the source code using the language object created above. Note that the source code needs to be a bytes object rather than a string.</li>
</ol>
<pre><code class="language-python">parser = Parser()
parser.set_language(language_object)
tree = parser.parse(bytes(source, &quot;utf8&quot;))
</code></pre>
<h2 id="notes-on-walking-tree-sitter-tree">Notes on walking tree-sitter Tree<a class="headerlink" href="#notes-on-walking-tree-sitter-tree" title="Permanent link"></a></h2>
<ul>
<li>Running parse will create a Tree of Node objects with the root node stored at tree.root_node. </li>
<li>Node objects only contain the fields <code>type</code>, <code>children</code>, <code>start_point</code>, <code>end_point</code>. To get the actual string identifier of a node, you need to infer it from the source code and the source reference information. The following is the implementation that the Fortran frontend uses. </li>
</ul>
<pre><code class="language-python">def get_identifier(self, node: Node, source: str) -&gt; str:
        &quot;&quot;&quot;Given a node, return the identifier it represents. ie. The code between node.start_point and node.end_point&quot;&quot;&quot;
        line_num = 0
        column_num = 0
        in_identifier = False
        identifier = &quot;&quot;
        for i, char in enumerate(source):
            if line_num == node.start_point[0] and column_num == node.start_point[1]:
                in_identifier = True
            elif line_num == node.end_point[0] and column_num == node.end_point[1]:
                break

            if char == &quot;\n&quot;:
                line_num += 1
                column_num = 0
            else:
                column_num += 1

            if in_identifier:
                identifier += char

        return identifier
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../generating_code2fn_model_coverage/" class="btn btn-neutral float-right" title="Generating code2fn model coverage reports">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../adding_new_model/" class="btn btn-neutral" title="Adding a new model"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2023 University of Arizona &amp; Lum AI.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ml4ai/skema/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../adding_new_model/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../generating_code2fn_model_coverage/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
